> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.cnblogs.com](https://www.cnblogs.com/cherryblossom/p/5502591.html)

**一、概述** 

 用户都希望他们访问的 web 应用是可交互且运行流畅的。因此，作为 web 开发者，也要在这方面多花点功夫。我们所做的页面，不但要能被快速加载，还要能流畅运行：页面的滚动要快速响应手指的动作，动画和交互效果更要如丝般顺滑。

       这样一来，想要编写高性能的 web 站点就需要充分了解浏览器如何处理 html/js/css，从而可以确保代码是高效的。

**二、FPS 和性能优化的必要**

       FPS 是每秒刷新频率，目前大多数设备的屏幕刷新率都是 **60** **次 / 秒** ，如果在页面中有一个动画或渐变效果，或者用户正在滑动页面，那么浏览器渲染动画或页面的每一帧的速率都要保持 16 毫秒（1 秒 / 60 = 16.66 毫秒）之内完成。

1. 页面渲染过程

       但实际上，在渲染某一帧画面的同时，浏览器还有一些额外的工作要做（比如渲染队列的管理，渲染线程与其他线程之间的切换等等）。因此单纯的渲染工作，一般需要控制在 10 毫秒之内完成，才能达到流畅的视觉效果。如果超过了这个时间限度，页面的渲染就会出现卡顿效果，也就是常说的 jank，它是很糟糕的用户体验。

       页面转化为屏幕上的像素大致要经历以下五个阶段：

      ![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174538013-363822321.png)

       从左到右依次是 JS，样式，布局，绘制，渲染层合并。

       a. 绘制：本质上就是填充像素的过程。第一步是创建一系列 draw 调用；第二步填充像素，也称为（rasterization）光栅化

       b 渲染层合并：指浏览器会将所有层按照合理的顺序合并成一个图层，然后显示在屏幕上。

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174610326-893231698.png)

**三、性能优化提升的方法**

1. 优化 javascript 的执行效率

1.1 对于动画效果的实现，避免使用 setTimeout 或 setInterval，请使用 requestAnimationFrame

_/**_

**function** updateScreen(time) {

  _// Make visual updates here._

}

requestAnimationFrame(updateScreen);

1.2 把耗时长的 JavaScript 代码放到 Web Workers 中去做

1.3 把 DOM 元素的更新划分为多个小任务，分别在多个 frame 中去完成

1.4 使用 Chrome DevTools 的 Timeline 和 JavaScript Profiler 来分析 JavaScript 的性能

2. 降低样式计算的范围和复杂度

       在最坏的情况下，样式计算量 = 元素个数 x 样式选择器个数。因为对每个元素最少需要检查一次所有的样式，以确认是否匹配。

2.1 降低样式选择器的复杂度；使用基于 class 的方式，比如 BEM

2.2 减少需要执行样式计算的元素的个数

2.3 使用 DevTools，选择 Timeline 标签，点击左上角红色 record 按钮

3. 避免大规模复杂的布局

       布局是浏览器计算 DOM 元素的几何信息的过程：元素大小和在页面中的位置。布局的时间消耗主要在于：需要布局的 DOM 元素的数量；布局过程的复杂程度。

3.1 应该尽可能避免触发布局：DOM 元素的几何属性的修改都需要重新布局

4. 简化绘制的复杂度、减少绘制区域

5. 优先使用渲染层合并属性、控制层的数量

6. 对用户输入时间的处理去

**四、chrome 控制台工具**

       控制台，也称开发者工具，是浏览器自带的一种调试工具。目前主流的控制台有：火狐的 firebug，chrome 开发工具，用于 safiri 的调试工具。

       用 chrome 浏览器打开任意网页点击 F12 或者点击鼠标右键选择 “审查元素” 都可以打开控制台。本文以 500 主站作为范例，点击 F12 出现控制台，如下图所示：

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174630623-1261219282.png)

总体有八个工具可供查看：元素，资源，网络，源，时间表，简介，审核，控制台。可以使用 Ctrl + [和 Ctrl +] 快捷键在面板之间移动。

Chrome 每个模块及其主要功能为：

Element ： 用于查看和编辑当前页面中的 HTML 和 CSS 元素。

Network ：用于查看 HTTP 请求的详细信息，如请求头、响应头及返回内容等。

Source ：用于查看和调试当前页面所加载的脚本的源文件。

TimeLine ： 用于查看脚本的执行时间、页面元素渲染时间等信息。

Profiles ：用于查看 CPU 执行时间与内存占用等信息。

Resource ：用于查看当前页面所请求的资源文件，如 HTML，CSS 样式文件等。

Audits ：用于优化前端页面，加速网页加载速度等。

Console ：用于显示脚本中所输出的调试信息，或运行测试脚本等。

本文主要讲时间表 timeline

 **时间表 TimeLine**

       每一个写进页面的资源都会有自己的渲染绘画结果，因而呈现了我们眼中很美的网页。但是也会消耗我们的资源，例如宽带，CPU，或者时间。资源被生成的时候就注定了周期，请求声明周期的主要阶段如下图所示:

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174739341-2556297.png)

时间表可以记录和运行分析应用程序所有的活动，为了使的记录_页面的交互_，打开时间轴面板，然后按开始录制录制按钮（），或者通过键入键盘快捷键 Cmd 的 +E（Mac）或按 Ctrl +E（Windows / Linux 版）。这个记录按钮会从灰色变成红色，而 Timeline 将开始从你的页面获取时间线（timeline）。在你的应用中完成一些操作，记录到一些数据之后，再一次点击按钮来停止记录。

请注意：会清除你现有的记录会话，以便开始一个新的会话。将会强迫 V8 完成一轮的垃圾回收，在调试中它很有用。将会对显示的详细信息进行过滤，只显示那些完成耗时超过 15ms 的记录

首先看一下 timeline 的主要目录：

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174756560-198983219.png)

       红色的点旁边是清除记录。后面的选项可以选择需要 capture 捕获的项。分别是网络，JS 简介，截图，存储，描绘。

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174814701-1861588269.png)

       展示方式有两种：左边是帧模式，右边是事件 event 模式. 帧模式可以深入到每一帧生成的内部细节。事件模式可以查看影响性能的成本要素优先级排序。

下图是一个任选的一个网页打开的时间表：

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174831763-727269164.png)

       第一个框里是概述，这里可以大致看到页面的性能。

       第二个框里是 event，即是事件监控。这是 CPU 的堆栈跟踪的可视化，绿色表示媒体时间，红色表示负载事件，蓝色表示 DOM 事件。

       第三个框里表示存储

       第四个框里是详细信息，这里会显示事件的详细信息。

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174850701-1731151873.png)

在这个模式中，Summary 视图 (在 Timeline 的顶部) 显示了一些水平的栅栏，分别代表页面中的网络和 HTML 解析 (蓝色)，JavaScript(黄色)，样式重计算和布局(紫色) 以及绘画和合成 (绿色) 事件。重绘是浏览器事件，是为响应诸如窗口大小改变或者滚动之类的视觉变化而调用的。

       在 Summary 视图下面是 Details 视图，包含了某个会话被记录后，相关类别的记录的详细内容。

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174917716-623197416.png)

     每一个记录在左侧有用于说明的标题，右侧是时间轴区域。鼠标移到一个记录之上，会显示更多的提示信息，其中包括从开始录制到结束的时间

3.CPU。CPU 资源。此区域图指明了事件的类型消耗的 CPU 资源。

       当选择了一个事件火焰表中，详细信息窗格显示有关该事件的更多信息，如下图所示：

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174942232-604192629.png)

       上图可见加载时间 0.02s，脚本 15.68s，渲染时间 11.28s，绘制时间 46.06s，其他时间 49.06s，空闲 1.27s 时间。

上图是总表。下图是详细汇总表。

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517174959138-187533959.png)

四、其他的功能

1. 连接安卓手机调试代码

       需要手机和电脑有 chrome 浏览器，安卓手机连接 USB 至 PC

1.1 在手机开发者工具中选择允许 USB 调试

1.2 打开 chrome://inspect/#devices，选择允许 USB 调试

会检测到可用的安卓手机和安卓手机打开的页面，也可以自己输入 url，如下图所示：

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517175019763-1033831942.png)

1.3 点击 图片中的 inspect, 即可进入手机页面的调试状态。

![](https://images2015.cnblogs.com/blog/689102/201605/689102-20160517175031701-1186074338.png)

这样就可以在电脑上操作和调试手机页面了。

因笔者水平有限，有参考大神文章，如果想了解更多可以查看以下链接：

http://wiki.jikexueyuan.com/project/chrome-devtools/overview.html

http://www.ibm.com/developerworks/cn/web/1410_wangcy_chromejs/

https://developers.google.com/web/fundamentals/performance/rendering/

附链接浏览器开发峰会：[https://youtu.be/RCFQu0hK6bU](https://youtu.be/RCFQu0hK6bU)